---
meta:
  - name: og:title
    content: 2022ë…„ 7ì›” 20ì¼ TIL
  - name: og:description
    content: 2022ë…„ 7ì›” 20ì¼ TIL - Firebase GitHub ì¸ì¦ - 2
tags:
  [
    "22-07",
    "Firebase",
    "OAuth",
    "GitHub"
  ]
---

# 22-07-20

## Firebaseë¡œ GitHub ì¸ì¦ - 2

ì´ì–´ì„œ ì•Œì•„ë³¼ ì‚¬í•­([07-19](/til/22-07/22-07-19.html)ì—ì„œ)

- `read:user`ë¥¼ í†µí•´ì„œ ì œê³µ ë°›ì€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°(ì‚¬ìš©ì í‘œì‹œ ì´ë¦„ ë“±)
  - ~~ìˆ˜ë™ ì €ì¥ ê³¼ì •ìœ¼ë¡œ ì§„í–‰í•´ë³´ë©´ ë ê¹Œ?~~
    - ~~ì¼ë‹¨ `tokenResponse`ì— `displayName`ìœ¼ë¡œ ì–»ì–´ì˜¬ ìˆ˜ëŠ” ìˆìŒ~~
  - ~~Authenticationì´ ì•„ë‹Œ `Firestore Database`ì— ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•˜ë‚˜?~~
  - í˜¹ì€ ë§¤ë²ˆ GitHub APIì— ìš”ì²­í•´ì•¼ í• ê¹Œ? âœ…

- `signInWithRedirect`ë¡œëŠ” ì œëŒ€ë¡œ ì§„í–‰ì´ ë˜ì§€ ì•ŠìŒ âœ…


## ì‚¬ìš©ì ì •ë³´ ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°

âœ… `addScope`ë¡œ ìŠ¤ì½”í”„ ì¶”ê°€ í•˜ì§€ ì•Šì•„ë„ ê¸°ë³¸ emailì •ë³´ëŠ” ê°€ì ¸ì˜´(emailë¡œ Firebase Authenticationì— ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•˜ì—¬ ë“±ë¡)

![ê°€ì…ì‹œ ìš”êµ¬ ì •ë³´ í™”ë©´](https://user-images.githubusercontent.com/78826879/180180910-9021d6e9-f68a-4c3e-86f1-b3db4fb5615d.png)


[ê³µì‹ë¬¸ì„œ](https://firebase.google.com/docs/auth/web/manage-users?hl=ko#get_a_users_provider-specific_profile_information)ëŒ€ë¡œ ì €ì¥ëœ ìœ ì € ì •ë³´ë¥¼ ê°€ì ¸ì™€ë³´ë©´ ì•„ë˜ ì •ë³´ë§Œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

```js
const userAuth = await onAuthStateChanged(auth, (user) => {
  if (user) {
    user.providerData.forEach(async (profile) => {
      console.log(profile);
      console.log("Sign-in provider: " + profile.providerId);
      console.log("  Provider-specific UID: " + profile.uid);
      console.log("  Name: " + profile.displayName);
      console.log("  Email: " + profile.email);
      console.log("  Photo URL: " + profile.photoURL);
    });
  };
// ì´í•˜ ìƒëµ
```
í•˜ì§€ë§Œ `displayName`ì„ ë¯¸ì„¤ì •í•œ ì‚¬ëŒ(ë‚˜ğŸ˜‡)ì˜ ê²½ìš°ì—ëŠ” `null`ë¡œ í‘œì‹œëœë‹¤.<br>
ìœ„ ì •ë³´ë¡œëŠ” ìœ ì €ì˜ ë¡œê·¸ì¸ID(ì´ë©”ì¼x)ë‚˜ URLì„ ì•Œ ìˆ˜ ì—†ë‹¤.

ì €ì¥ëœ ì •ë³´ì¤‘ `UID`ì™€ `GitHub API`ë¥¼ ì´ìš©í•´ì„œ í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì ([ê³µì‹ë¬¸ì„œ](https://docs.github.com/en/rest/users/users#get-the-authenticated-user))

### GitHub APIë¡œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°

`https://api.github.com/user/${uid}` ë¡œ ì•„ë˜ ë°©ë²•ê³¼ ê°™ì´ ìš”ì²­í•  ìˆ˜ ìˆë‹¤.

```js
fetch(`https://api.github.com/user/${uid}`, {
  headers: { 
    Accept: "application/json", 
    Authorization: token 
  },
})
```

í† í°ì€ `user.accessToken`ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```js
const userAuth = await onAuthStateChanged(auth, (user) => {
// const userAuth = await onAuthStateChanged(auth, ({token}) => { ë„ ê°€ëŠ¥í•˜ë‹¤.
  if (user) {
    const token = user.accessToken 
  };

  // ì´í•˜ ìƒëµ
```

[user-to-serverìš”ì²­](https://docs.github.com/en/github-ae@latest/developers/apps/building-github-apps/rate-limits-for-github-apps#user-to-server-requests)ì´ë¯€ë¡œ ì‹œê°„ë‹¹ 15,000íšŒë¡œ ì œí•œëœë‹¤.

GitHub Users APIë¥¼ ì´ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì€ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

```
{
  "login": "octocat",
  "id": 1,
  "node_id": "MDQ6VXNlcjE=",
  "avatar_url": "https://github.com/images/error/octocat_happy.gif",
  "gravatar_id": "",
  "url": "https://api.github.com/users/octocat",
  "html_url": "https://github.com/octocat",
  "followers_url": "https://api.github.com/users/octocat/followers",
  "following_url": "https://api.github.com/users/octocat/following{/other_user}",
  "gists_url": "https://api.github.com/users/octocat/gists{/gist_id}",
  "starred_url": "https://api.github.com/users/octocat/starred{/owner}{/repo}",
  "subscriptions_url": "https://api.github.com/users/octocat/subscriptions",
  "organizations_url": "https://api.github.com/users/octocat/orgs",
  "repos_url": "https://api.github.com/users/octocat/repos",
  "events_url": "https://api.github.com/users/octocat/events{/privacy}",
  "received_events_url": "https://api.github.com/users/octocat/received_events",
  "type": "User",
  "site_admin": false,
  "name": "monalisa octocat",
  "company": "GitHub",
  "blog": "https://github.com/blog",
  "location": "San Francisco",
  "email": "octocat@github.com",
  "hireable": false,
  "bio": "There once was...",
  "twitter_username": "monatheoctocat",
  "public_repos": 2,
  "public_gists": 1,
  "followers": 20,
  "following": 0,
  "created_at": "2008-01-14T04:33:35Z",
  "updated_at": "2008-01-14T04:33:35Z",
  "private_gists": 81,
  "total_private_repos": 100,
  "owned_private_repos": 100,
  "disk_usage": 10000,
  "collaborators": 8,
  "two_factor_authentication": true,
  "plan": {
    "name": "Medium",
    "space": 400,
    "private_repos": 20,
    "collaborators": 0
  }
}
```

`login`, `html_url`, `avatar_url`ë“±ì„ í™œìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.


## Firebaseë¡œ GitHub ì¸ì¦ (signInWithRedirect)

signInWithPopupê³¼ ë‹¬ë¦¬ `signInWithRedirect`ê°€ ë™ì‘í•˜ì§€ ì•Šì•˜ëŠ”ë°, ì´ ë¬¸ì œëŠ” ì´ ì´ìŠˆ([`Firebase Auth is no longer working in incognito mode`](https://github.com/firebase/firebase-js-sdk/issues/3004))ì™€ ê´€ë ¨ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ ìƒê°ëœë‹¤.

ì‹¤ì œë¡œ ì‹œí¬ë¦¿ëª¨ë“œê°€ ì•„ë‹Œ í™˜ê²½ì—ì„œëŠ” ì˜ ë™ì‘í–ˆë‹¤..ğŸ˜‡
ì¼ë‹¨ í˜„ì¬ë¡œì„œ ì‚¬ìš©ìê°€ ì‹œí¬ë¦¿ ëª¨ë“œë¥¼ ì´ìš©í•˜ì§€ ì•Šë„ë¡ ì•ˆë‚´í•˜ëŠ” ë°©ë²• ë³´ë‹¤ëŠ” popupìœ¼ë¡œ ë¡œê·¸ì¸ì„ ì—°ê²°í•˜ëŠ” ê²Œ ë‚˜ì€ ë°©ë²•ì¼ ê²ƒ ê°™ë‹¤.
